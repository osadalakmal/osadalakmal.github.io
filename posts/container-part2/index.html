<!DOCTYPE html>
<html lang="en-gb">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='We discuss container tooling beyond docker. Runtime engines, container build, deployment and registry tooling'><title>Not your grandmas&#39; docker - Part 2</title>

<link rel='canonical' href='https://osadalakmal.github.io/posts/container-part2/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='Not your grandmas&#39; docker - Part 2'>
<meta property='og:description' content='We discuss container tooling beyond docker. Runtime engines, container build, deployment and registry tooling'>
<meta property='og:url' content='https://osadalakmal.github.io/posts/container-part2/'>
<meta property='og:site_name' content='Curiously Recurring Thoughts in Programming'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts' /><meta property='article:tag' content='docker' /><meta property='article:tag' content='virtualization' /><meta property='article:tag' content='buildah' /><meta property='article:published_time' content='2021-08-26T10:00:50&#43;05:30'/><meta property='article:modified_time' content='2021-08-26T10:00:50&#43;05:30'/><meta property='og:image' content='https://osadalakmal.github.io/img/container-arial.jpg' />
<meta name="twitter:site" content="@osadaparanaliyanage">
    <meta name="twitter:creator" content="@osadaparanaliyanage"><meta name="twitter:title" content="Not your grandmas&#39; docker - Part 2">
<meta name="twitter:description" content="We discuss container tooling beyond docker. Runtime engines, container build, deployment and registry tooling"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://osadalakmal.github.io/img/container-arial.jpg' />
    <link rel="shortcut icon" href="/img/favicon.ico" />

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-42954847-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "auto");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="https://osadalakmal.github.io" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>Back</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/posts/container-part2/">
                
                    <img src="/img/container-arial.jpg" loading="lazy" alt="Featured image of post Not your grandmas&#39; docker - Part 2" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/virtualization/" >
                virtualization
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/posts/container-part2/">Not your grandmas&#39; docker - Part 2</a>
    </h2>

    
    <h3 class="article-subtitle">
        We discuss container tooling beyond docker. Runtime engines, container build, deployment and registry tooling
    </h3>
    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Aug 26, 2021</time>
            </div>
        

        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <div class="toc">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#components-of-the-container-ecosystem">Components of the container ecosystem</a>
      <ul>
        <li><a href="#container-engines">Container Engines</a></li>
        <li><a href="#container-host">Container Host</a></li>
        <li><a href="#registry-server">Registry Server</a></li>
        <li><a href="#container-orchestration">Container Orchestration</a></li>
        <li><a href="#container-runtime">Container Runtime</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
  
<p>Now that we have discussed the basics of containers, lets dive in to the details. Modern container tooling goes way beyond simply running an OS image in a separate context.</p>
<h2 id="components-of-the-container-ecosystem">Components of the container ecosystem</h2>
<p><figure 
	>
	<a href="/img/DockerEcosystem.png" >
		<img src="/img/DockerEcosystem.png"
			
			
			
			loading="lazy"
			alt="Container Ecosystem">
	</a>
	
	<figcaption>Container Ecosystem</figcaption>
	
</figure></p>
<h3 id="container-engines">Container Engines</h3>
<p>A container engine will run a container given the user input to do so. You can customize it&rsquo;s behavior through several parameters. Note that it does not necessarily need to know where images are on remote servers and how to get them. In fact it even does not actually run them by itself, usually thats delegated to the container runtime. More on that later. And there are of course proprietary implementations of container engines at various cloud providers.</p>
<p>The basic responsibilities of this layer include</p>
<ul>
<li>Using various input to determine runtime behavior of the container (network, storage, etc)</li>
<li>Decompressing and expanding the container image on disk using a Graph Driver</li>
<li>Preparing a container mount point, typically on COW (copy on write) storage</li>
<li>Creating a config.json file with metadata to be passed to the container runtime</li>
<li>Invoking the Container Runtime</li>
</ul>
<p>Options for this component include</p>
<ul>
<li><a class="link" href="https://www.docker.com"  target="_blank" rel="noopener"
    >Docker</a></li>
<li><a class="link" href="https://github.com/rkt/rkt"  target="_blank" rel="noopener"
    >RKT</a></li>
<li><a class="link" href="https://cri-o.io/"  target="_blank" rel="noopener"
    >CRI-O</a></li>
<li><a class="link" href="https://linuxcontainers.org/lxd/introduction/#LXD"  target="_blank" rel="noopener"
    >LXD</a></li>
</ul>
<h3 id="container-host">Container Host</h3>
<p>The container host is the system that runs the containers. This could be your local machine running an *nix OS, a VM on the same or a VM/baremetal machine on public/private cloud. Once a container image is pulled from a Registry Server to the local container host, it is said to be in the local cache.</p>
<h3 id="registry-server">Registry Server</h3>
<p>A registry server is essentially a server that is used to store and server docker images from. These are just URIs usually connected to over HTTPS. you would usually use REST API to interact with them.</p>
<p>When a container runtime finds that a container image cannot be found in the local cache, it <em>can</em> invoke a tool to fetch the container image (aka repository) from the registry server. The most well known registry server is docker.io but there are several public alternatives as well as implementations that can be hosted privately for more customization and security. There are also registries that can be reached publicly but only hosts private container images/repositories. Note that these should handled very carefully due to supply chain attacks. It is very important that you think out the consequences of what registries you enable and the security around that.</p>
<h4 id="public-container-registries">Public container registries</h4>
<ul>
<li><a class="link" href="https://docker.io"  target="_blank" rel="noopener"
    >DockerHub</a></li>
<li><a class="link" href="https://quay.io/"  target="_blank" rel="noopener"
    >CoreOS Quay</a></li>
</ul>
<h4 id="public-reachable---private-repository-registries">Public reachable - private repository registries</h4>
<ul>
<li><a class="link" href="https://aws.amazon.com/ecr/"  target="_blank" rel="noopener"
    >Elastic Container Registry</a></li>
<li><a class="link" href="https://cloud.google.com/container-registry/"  target="_blank" rel="noopener"
    >Google Container Registry</a></li>
<li><a class="link" href="https://azure.microsoft.com/en-us/services/container-registry/"  target="_blank" rel="noopener"
    >Azure Container Registry</a></li>
</ul>
<h4 id="self-hosted-registries">Self hosted registries</h4>
<ul>
<li><a class="link" href="https://docs.docker.com/datacenter/dtr/2.4/guides/"  target="_blank" rel="noopener"
    >Docker Trusted Registry</a></li>
<li><a class="link" href="https://github.com/vmware/harbor"  target="_blank" rel="noopener"
    >Harbor</a></li>
<li><a class="link" href="https://www.jfrog.com/confluence/display/RTF/Getting&#43;Started&#43;with&#43;Artifactory&#43;as&#43;a&#43;Docker&#43;Registry"  target="_blank" rel="noopener"
    >JFrog Artifactory</a></li>
</ul>
<h3 id="container-orchestration">Container Orchestration</h3>
<p>Container usage usually starts with a single developer using a docker image to test out his software and making sure it is working as intended. But once multiple teams and multiple applications get involved, you run in to more facets to consider such as shared networking, storage, monitoring and a whole host of others. This is basically the difference between &ldquo;run on my machine&rdquo; vs &ldquo;should run on production&rdquo;. Shipping these applications to production and running these there involves a lot more scaffolding than just running a single container on a developers machine.</p>
<h4 id="responsibilities-of-the-container-orchestration-system">Responsibilities of the Container Orchestration System</h4>
<ul>
<li>Scheduling and running container workloads on top of a resource provisioning system</li>
<li>Providing networking layer for containers to inter-communicate</li>
<li>Providing network traffic control</li>
<li>Service Discovery (optional)</li>
<li>Providing a standardized system definition file (helm charts, k8s yaml, docker compose etc)</li>
</ul>
<h4 id="container-orchestration-systems">Container Orchestration Systems</h4>
<ul>
<li><a class="link" href="https://kubernetes.io/"  target="_blank" rel="noopener"
    >kubernetes</a></li>
<li><a class="link" href="https://mesosphere.github.io/marathon/"  target="_blank" rel="noopener"
    >mesos + marathon</a></li>
<li><a class="link" href="https://docs.docker.com/engine/swarm/"  target="_blank" rel="noopener"
    >Docker Swarm</a></li>
</ul>
<h3 id="container-runtime">Container Runtime</h3>
<p>A container runtime actually runs the container image that is on disk essentially converting the on-disk container image to a running process set. The Open Containers Initiative (OCI) Runtime Standard reference implementation  is runc. This is the most widely used container runtime, but there are others OCI compliant runtimes. There are various types of them as well. Some are native runtimes that run the container directly on the host. Some are sandboxed runtimes that run either on a kernel proxy layer or a unikernel. And the latest addition to this space is the standardized interface into kubernetes container runtime - Container Runtime Interface. Kubernetes started with docker runtime as the only option for this and as time went by they started to migrate away from the docker dependency. As they did, they introduced CRI as a way to democratizing/virtualizing the runtime tooling. Now there are multiple conforming implementations</p>
<h4 id="responsibilities-of-the-container-runtime">Responsibilities of the container runtime</h4>
<ul>
<li>Setting up the container image fs view at the mount point given</li>
<li>Using the config json to customize the container runtime parameters</li>
<li>Starting the containerized process using clone or similar syscall</li>
<li>Setting the isolation and security constructs such as cgroups,  namespace and SELinux</li>
</ul>
<h4 id="container-runtime-systems">Container Runtime Systems</h4>
<ul>
<li>Open Container Initiative (OCI) Runtimes
<ul>
<li>Native Runtimes
<ul>
<li>runC</li>
<li>Railcar</li>
<li>Crun</li>
<li>rkt</li>
</ul>
</li>
<li>Sandboxed and Virtualized Runtimes
<ul>
<li>gviso</li>
<li>runV</li>
<li>kata-containers</li>
</ul>
</li>
</ul>
</li>
<li>Container Runtime Interface
<ul>
<li>containerd</li>
<li>cri-o</li>
</ul>
</li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/docker/">docker</a>
        
            <a href="/tags/virtualization/">virtualization</a>
        
            <a href="/tags/buildah/">buildah</a>
        
    </section>


    </footer>


    
</article>

    <aside class="related-contents--wrapper">
</aside>
     
     
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2022 Curiously Recurring Thoughts in Programming
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.2.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">Table of contents</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#components-of-the-container-ecosystem">Components of the container ecosystem</a>
      <ul>
        <li><a href="#container-engines">Container Engines</a></li>
        <li><a href="#container-host">Container Host</a></li>
        <li><a href="#registry-server">Registry Server</a></li>
        <li><a href="#container-orchestration">Container Orchestration</a></li>
        <li><a href="#container-runtime">Container Runtime</a></li>
      </ul>
    </li>
  </ul>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
